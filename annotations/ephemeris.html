<!DOCTYPE html>  <html> <head>   <title>ephemeris.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ephemeris.html">                 ephemeris.coffee               </a>                                           <a class="source" href="phase.html">                 phase.coffee               </a>                                           <a class="source" href="points.html">                 points.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ephemeris.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Gaia    = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;upon&quot;</span><span class="p">).</span><span class="nx">Home</span>
<span class="nv">which   = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;which&quot;</span><span class="p">)</span>
<span class="nv">_       = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;massagist&quot;</span><span class="p">).</span><span class="nx">_</span>
<span class="nv">Massage = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;massagist&quot;</span><span class="p">).</span><span class="nx">Massage</span>
<span class="nv">points  = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./points&quot;</span><span class="p">)</span>
<span class="nv">phase   = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./phase&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nx">Ephemeris</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The defaults-overriding options will become part of
the help command, the man-pages / docs and the gh-pages.
For example the <code>-o</code> that overrides <code>@settings.out</code> can be:</p>

<ul>
<li><code>points</code> (phase is based on it)</li>
<li><code>phase</code> (your CLI Formatting Friend)</li>
<li><code>points,table</code> (raw cliff output of points)</li>
<li><code>json</code> (the precious json)</li>
<li><code>json,codedown</code> (markdown code block html)</li>
<li><code>print</code> (python's print)</li>
<li><code>pprint</code> (python's pretty-substitutes swe labels)</li>
<li><code>inspect</code> (the pretty eyes thing)</li>
<li>see <code>Massage</code> for more options...</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">defaults:</span>
    <span class="s2">&quot;root&quot;</span><span class="o">:</span> <span class="s2">&quot;#{__dirname}/../&quot;</span>
    <span class="s2">&quot;out&quot;</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span>
    <span class="s2">&quot;time&quot;</span><span class="o">:</span> <span class="kc">null</span>
    <span class="s2">&quot;geo&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">}</span>
    <span class="s2">&quot;stuff&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
             <span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
             <span class="p">,</span> <span class="p">[</span><span class="mi">5145</span><span class="p">,</span> <span class="mi">7066</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">28978</span><span class="p">,</span> <span class="mi">38628</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">90377</span><span class="p">,</span> <span class="mi">90482</span><span class="p">,</span> <span class="mi">136108</span><span class="p">,</span> <span class="mi">136199</span><span class="p">,</span> <span class="mi">136472</span><span class="p">]</span>
             <span class="p">]</span>
    <span class="s2">&quot;houses&quot;</span><span class="o">:</span> <span class="s2">&quot;W&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Configure ephemeris specifics, this is valid precious input.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">configure: </span><span class="nf">(specifics, cb) -&gt;</span>
    <span class="vi">@specifics = </span><span class="nx">specifics</span> <span class="k">if</span> <span class="nx">specifics</span><span class="o">?</span>
    <span class="vi">@settings = </span><span class="nx">_</span><span class="p">.</span><span class="nx">allFurther</span> <span class="nx">@defaults</span><span class="p">,</span> <span class="nx">@specifics</span>

    <span class="nx">unless</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/^\//</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>If not absolute, then relative (to eden) ephemeris data path.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@settings.data = </span><span class="s2">&quot;#{@settings.root}#{@settings.data}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The @settings.ut and @settings.geo - being reset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@gaia = </span><span class="k">new</span> <span class="nx">Gaia</span> <span class="nx">@settings</span><span class="p">[</span><span class="s2">&quot;geo&quot;</span><span class="p">],</span> <span class="nx">@settings</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
    <span class="vi">@settings.geo = </span><span class="p">{}</span>
    <span class="vi">@settings.geo.lat = </span><span class="nx">@gaia</span><span class="p">.</span><span class="nx">lat</span>
    <span class="vi">@settings.geo.lon = </span><span class="nx">@gaia</span><span class="p">.</span><span class="nx">lon</span>
    <span class="vi">@settings.ut = </span><span class="nx">@gaia</span><span class="p">.</span><span class="nx">ut</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The @ephemeris is a function that implements
<a href="http://astrolet.github.com/precious/json.7.html">precious json</a> -
input &amp; output conforming to the spec.  It is optional,
as we may just want to use this class for generating ephemeris input -
the output results being deferred for later perhaps.
It's only set once, as it isn't expected to change.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">@ephemeris</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">precious</span>
        <span class="vi">@ephemeris = </span><span class="nx">require</span><span class="p">(</span><span class="nx">@settings</span><span class="p">.</span><span class="nx">precious</span><span class="p">).</span><span class="nx">ephemeris</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This can be called in various contexts.  Example: the callback can be used
when the ephemeris paths are not immediately known (a global precious).
It's passed via the <code>@constructor</code> / <code>@preciousPaths</code>
- see the following sections...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">cb</span><span class="p">()</span> <span class="k">if</span> <span class="nx">cb</span><span class="o">?</span>
    <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Because precious is not a dependency, nor is gravity,
get the paths from a global precious install.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">preciousPaths: </span><span class="nf">(cb) -&gt;</span>
    <span class="nx">which</span> <span class="s2">&quot;precious&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">thing</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">er</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>TODO: handle precious not installed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
        <span class="vi">@defaults.precious = </span><span class="kc">null</span>
      <span class="k">else</span>
        <span class="nv">apath = </span><span class="nx">thing</span><span class="p">.</span><span class="nx">substring</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">thing</span><span class="p">.</span><span class="nx">lastIndexOf</span> <span class="s1">&#39;/&#39;</span>
        <span class="nx">apath</span> <span class="o">+=</span> <span class="s1">&#39;/../lib/node_modules/precious/&#39;</span>
        <span class="vi">@defaults.data = </span><span class="nx">apath</span> <span class="o">+</span> <span class="s1">&#39;node_modules/gravity/data/&#39;</span>
        <span class="vi">@defaults.prep = </span><span class="nx">apath</span> <span class="o">+</span> <span class="s1">&#39;bin/&#39;</span>
        <span class="vi">@defaults.precious = </span><span class="nx">apath</span> <span class="o">+</span> <span class="s1">&#39;index.js&#39;</span>
        <span class="nx">cb</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Pass a callback if you need to call @run <em>immediately</em>, or something...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(specifics = {}, cb) -&gt;</span>
    <span class="k">switch</span> <span class="nx">specifics</span><span class="p">.</span><span class="nx">precious</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We don't want to call precious and don't care where may be installed.
Nothing special to do here.  This is how we use eden to get
json input configuration for perhaps later calling precious with.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="kc">false</span> <span class="k">then</span> <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Precious manually installed locally in <code>./node_modules</code>.
Takes one's <code>specifics</code> word for it, without checking.
This may be how things will be done in the future -
by default if precious becomes a dependency.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="kc">true</span>
        <span class="nv">apath = </span><span class="s1">&#39;./node_modules/&#39;</span>
        <span class="vi">@defaults.data = </span><span class="s1">&#39;precious/node_modules/gravity/data/&#39;</span>
        <span class="vi">@defaults.prep = </span><span class="s1">&#39;.bin/&#39;</span>
        <span class="vi">@defaults.precious = </span><span class="s1">&#39;precious/index.js&#39;</span>
        <span class="nv">specifics.precious = </span><span class="kc">undefined</span> <span class="c1"># so that the default takes</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Undefined may become null.  Unknown what the paths are.
Expecting a global precious install.  There may be none, which is null.
Null is bad - because undefined implies intent to use precious.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">when</span> <span class="kc">undefined</span>
        <span class="k">return</span> <span class="nx">@preciousPaths</span> <span class="o">=&gt;</span> <span class="nx">@configure</span> <span class="nx">specifics</span><span class="p">,</span> <span class="nx">cb</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Unless all the paths have been given as specifics, throw an error.
Of-course, it's assumed that the paths are valid.
More about completeness than intended use.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
        <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">specifics</span><span class="p">.</span><span class="nx">precious</span>
          <span class="k">throw</span> <span class="s2">&quot;Invalid precious specifics!&quot;</span>

    <span class="k">return</span> <span class="nx">@configure</span> <span class="nx">specifics</span><span class="p">,</span> <span class="nx">cb</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>A way to change just the output format, with possible method-chaining.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">out: </span><span class="nf">(treats) -&gt;</span>
    <span class="vi">@settings.out = </span><span class="nx">treats</span>
    <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Just for processing <em>points</em> output as json (at this point).
It also sets up the <em>points</em> json for <em>phase</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pre: </span><span class="nf">(stream) -&gt;</span>
    <span class="nv">process = </span><span class="kc">true</span>
    <span class="nv">the_points = </span><span class="s2">&quot;points&quot;</span>
    <span class="nv">becoming = </span><span class="s2">&quot;json&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>This is so that the_points can be passed as JSON to <code>Massage</code> further.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="nx">the_points</span>
      <span class="p">[</span><span class="nx">process</span><span class="p">,</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">the_points</span><span class="p">,</span> <span class="nx">becoming</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Only the data changes for the following, <code>@settings.out</code> remains as is.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">include</span> <span class="p">[</span><span class="nx">the_points</span><span class="p">,</span> <span class="s2">&quot;phase&quot;</span><span class="p">],</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
      <span class="nv">process = </span><span class="nx">the_points</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Specific processing (e.g. points), or else return the same stream
without changing anything at all.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">process</span> <span class="o">is</span> <span class="nx">the_points</span>
      <span class="nx">points</span> <span class="nx">stream</span>
    <span class="k">else</span>
      <span class="nx">stream</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>This is the reason <code>Ephemeris</code> exists, though running it sometimes just gets
the <code>@settings</code>, so that the precious ephemeris can perhaps later be invoked
conveniently with - or else simply for whatever reason - besides any bugs...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">run: </span><span class="nf">(stream) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>However, Ephemeris can't always be <code>@run</code> nor it is necessarily desirable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">precious</span> <span class="o">is</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Note: this isn't fit for rerun as <code>@settings</code> are being changed...</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span> <span class="o">isnt</span> <span class="s2">&quot;json&quot;</span>
        <span class="vi">@settings.out = </span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Clean-up the <code>@settings</code> for later use.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">delete</span> <span class="nx">@settings</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;precious&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
        <span class="nv">massage = </span><span class="k">new</span> <span class="nx">Massage</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
        <span class="nx">massage</span><span class="p">.</span><span class="nx">write</span>   <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">@settings</span><span class="p">),</span> <span class="nx">stream</span>
      <span class="k">else</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">write</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">@settings</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">else</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@ephemeris</span>
      <span class="k">throw</span> <span class="s2">&quot;No ephemeris to run!&quot;</span>
    <span class="k">else</span>
      <span class="nv">ephemeris = </span><span class="nx">@ephemeris</span> <span class="nx">@settings</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>An array of massage steps.  Expected to be something valid that
Massage can handle.  The <code>eden</code> (cli) sets up an <code>Array</code>
if <code>--out</code> is a comma-delimited sequence.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
      <span class="nv">streamin = </span><span class="nx">@pre</span> <span class="nx">ephemeris</span>
      <span class="nv">massage = </span><span class="k">new</span> <span class="nx">Massage</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
      <span class="nx">massage</span><span class="p">.</span><span class="nx">pipe</span> <span class="nx">streamin</span><span class="p">,</span> <span class="nx">stream</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>The rest of these are special cases or else straight output of whatever
precious returns.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>These are the non-array single massage steps for which json is assumed
being implied for a starting point.  Basically a list of valid,
single massage steps for a more readable json output.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">include</span> <span class="p">[</span><span class="s2">&quot;inspect&quot;</span><span class="p">,</span> <span class="s2">&quot;indent&quot;</span><span class="p">],</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span>
      <span class="nv">massage = </span><span class="k">new</span> <span class="nx">Massage</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span><span class="p">]</span>
      <span class="nx">massage</span><span class="p">.</span><span class="nx">pipe</span> <span class="nx">ephemeris</span><span class="p">,</span> <span class="nx">stream</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The most readable output of <code>eden</code> and
the default in the context of cli usage.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">out</span> <span class="o">is</span> <span class="s2">&quot;phase&quot;</span>
      <span class="nx">phase</span> <span class="p">(</span><span class="nx">@pre</span> <span class="nx">ephemeris</span><span class="p">),</span> <span class="nx">stream</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Unprocessed - straight from <em>precious</em>, whatever didn't get caught above.
For example <code>eden -o pprint</code>.
Unless @pre modifies the data (points).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="nx">@pre</span><span class="p">(</span><span class="nx">ephemeris</span><span class="p">).</span><span class="nx">pipe</span> <span class="nx">stream</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Special (error) cases.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ephemeris</span><span class="p">.</span><span class="kc">on</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nf">(data) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Know when all the data has been got.
Useful for post-formatting with trailing <code>\n</code> by the cli, for example.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ephemeris</span><span class="p">.</span><span class="kc">on</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">emit</span> <span class="s2">&quot;end&quot;</span>


<span class="nv">module.exports = </span><span class="nx">Ephemeris</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 